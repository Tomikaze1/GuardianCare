<ion-content class="notifications-content" fullscreen>
  <div class="logo-container">
    <div class="logo-wrapper">
      <div class="custom-logo">
        <ion-icon name="shield" class="shield-icon"></ion-icon>
        <ion-icon name="notifications" class="notifications-icon"></ion-icon>
      </div>
      <div class="logo-glow"></div>
    </div>
    <div class="app-title">Notifications</div>
    <div class="app-subtitle">New incident reports and validations</div>
    <div class="title-underline"></div>
  </div>

  <div class="notification-history-section">
    <div class="section-header">
      <span>My Notifications</span>
      <div class="section-underline"></div>
    </div>

    <div class="filters-row" *ngIf="notifications.length > 0">
      <ion-chip 
        [outline]="activeFilter !== 'all'" 
        (click)="setFilter('all')"
        [class.active-filter]="activeFilter === 'all'"
        [class.inactive-filter]="activeFilter !== 'all'">
        All
      </ion-chip>
      <ion-chip 
        [outline]="activeFilter !== 'new'" 
        (click)="setFilter('new')"
        [class.active-filter]="activeFilter === 'new'"
        [class.inactive-filter]="activeFilter !== 'new'">
        New
      </ion-chip>
      <ion-chip 
        [outline]="activeFilter !== 'unread'" 
        (click)="setFilter('unread')"
        [class.active-filter]="activeFilter === 'unread'"
        [class.inactive-filter]="activeFilter !== 'unread'">
        Unread
      </ion-chip>
    </div>

    <div class="notifications-list" *ngIf="filteredNotifications.length > 0">
      <div class="notification-card" 
           *ngFor="let notification of filteredNotifications; trackBy: trackByNotificationId"
           [class.unread]="!notification.read"
           (click)="handleNotificationClick(notification)">
        
        <div class="notification-header">
          <div class="notification-type">
            <ion-icon [name]="getNotificationIcon(notification.type)"></ion-icon>
            <span>{{ getNotificationTypeLabel(notification.type) }}</span>
            <ion-badge *ngIf="shouldShowNewBadge(notification)" color="success" class="new-badge">NEW</ion-badge>
          </div>
          <ion-chip [color]="getStatusColor(notification)" size="small" *ngIf="notification.type === 'report_validated' || notification.type === 'new_zone'">
            <ion-icon [name]="getStatusIcon(notification)"></ion-icon>
            <ion-label>{{ getStatusText(notification) }}</ion-label>
          </ion-chip>
        </div>

        <div class="notification-date">
          <ion-icon name="calendar-outline"></ion-icon>
          <span>{{ formatTimestamp(notification.timestamp) }}</span>
        </div>

        <div class="notification-location" *ngIf="notification.data?.locationAddress">
          <ion-icon name="location-outline"></ion-icon>
          <span>{{ notification.data?.locationAddress }}</span>
        </div>

        <div class="notification-description">
          <p [innerHTML]="formatNotificationMessage(notification)"></p>
        </div>

        <div class="notification-validation" *ngIf="notification.data?.adminLevel">
          <div class="validation-header">
            <ion-icon name="shield-checkmark-outline"></ion-icon>
            <span>Admin Risk Assessment</span>
          </div>
          <div class="validation-level-indicator">
            <div class="level-color-bar" [style.background]="getRiskLevelColor(notification.data.adminLevel)"></div>
            <span class="validation-score">Level {{ notification.data.adminLevel }} - {{ getRiskLevelText(notification.data.adminLevel) }} Risk</span>
          </div>
          <div class="validation-date">
            <small>{{ notification.type === 'report_validated' ? 'Validated on' : 'Alert created' }} {{ formatTimestamp(notification.timestamp) }}</small>
          </div>
        </div>

      </div>
    </div>

    <div class="no-notifications" *ngIf="notifications.length === 0">
      <ion-icon name="notifications-off-outline"></ion-icon>
      <h3>No Notifications Yet</h3>
      <p>You don't have any notifications yet. New incident reports and validations will appear here.</p>
    </div>

    <div class="action-buttons" *ngIf="notifications.length > 0">
      <ion-button 
        expand="block" 
        fill="outline"
        color="success"
        (click)="markAllAsRead()"
        class="action-btn">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Mark All Read
      </ion-button>
      <ion-button 
        expand="block" 
        fill="solid" 
        color="danger"
        (click)="clearAllNotifications()"
        class="action-btn">
        <ion-icon name="trash-outline" slot="start"></ion-icon>
        Clear All
      </ion-button>
    </div>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading notifications...</p>
  </div>
</ion-content>
