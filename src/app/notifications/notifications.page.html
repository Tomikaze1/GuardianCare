<ion-content class="notifications-content" fullscreen>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="arrow-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="lines"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Header - Exact Match to Reports Design -->
  <div class="logo-container">
    <div class="logo-wrapper">
      <div class="custom-logo">
        <ion-icon name="shield" class="shield-icon"></ion-icon>
        <ion-icon name="notifications" class="notifications-icon"></ion-icon>
      </div>
      <div class="logo-glow"></div>
    </div>
    <div class="app-title">{{ 'NOTIFICATIONS.TITLE' | translate }}</div>
    <div class="app-subtitle">{{ 'NOTIFICATIONS.SUBTITLE' | translate }}</div>
    <div class="title-underline"></div>
    
    <!-- Offline/Online Status Indicator -->
    <div class="connection-status" [class.offline]="!isOnline">
      <ion-icon [name]="isOnline ? 'wifi-outline' : 'wifi-off-outline'" [color]="isOnline ? 'success' : 'warning'"></ion-icon>
      <span>{{ isOnline ? 'Online' : 'Offline' }}</span>
      <ion-button *ngIf="!isOnline" fill="clear" size="small" (click)="manualSync()">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Notification History Section -->
  <div class="notification-history-section">
    <div class="section-header">
      <span>My Notifications</span>
      <div class="section-underline"></div>
    </div>


    <div class="notifications-list" *ngIf="filteredNotifications.length > 0">
      <div class="notification-card" 
           *ngFor="let notification of filteredNotifications; trackBy: trackByNotificationId"
           [class.unread]="!notification.read"
           (click)="markAsRead(notification)">
        
        <div class="notification-header">
          <div class="notification-type">
            <ion-icon [name]="getNotificationIcon(notification.type)"></ion-icon>
            <span>{{ getNotificationTypeLabel(notification.type) }}</span>
            <ion-badge *ngIf="!notification.read" color="success" class="new-badge">NEW</ion-badge>
          </div>
          <ion-chip [color]="getStatusColor(notification)" size="small" *ngIf="notification.type === 'report_validated'">
            <ion-icon [name]="getStatusIcon(notification)"></ion-icon>
            <ion-label>{{ getStatusText(notification) }}</ion-label>
          </ion-chip>
        </div>

        <div class="notification-date">
          <ion-icon name="calendar-outline"></ion-icon>
          <span>{{ formatTimestamp(notification.timestamp) }}</span>
        </div>

        <div class="notification-location" *ngIf="notification.data?.locationAddress">
          <ion-icon name="location-outline"></ion-icon>
          <span>{{ notification.data?.locationAddress }}</span>
        </div>

        <div class="notification-description">
          <p [innerHTML]="formatNotificationMessage(notification)"></p>
        </div>

        <!-- Admin Risk Level -->
        <div class="notification-validation" *ngIf="notification.data?.adminLevel">
          <div class="validation-header">
            <ion-icon name="shield-checkmark-outline"></ion-icon>
            <span>Admin Risk Level</span>
          </div>
          <div class="validation-level-indicator">
            <div class="level-color-bar" [style.background]="getRiskLevelColor(notification.data.adminLevel || 1)"></div>
            <span class="validation-score">Level {{ notification.data.adminLevel || 1 }} - {{ getRiskLevelText(notification.data.adminLevel || 1) }}</span>
          </div>
          <div class="validation-date">
            <small>{{ notification.type === 'report_validated' ? 'Validated on' : 'Created on' }} {{ formatTimestamp(notification.timestamp) }}</small>
          </div>
        </div>

        <ion-button 
          expand="block" 
          fill="clear" 
          size="small"
          (click)="viewNotificationDetails(notification); $event.stopPropagation()"
          class="view-details-btn">
          <ion-icon name="information-circle-outline" slot="start"></ion-icon>
          View Full Details
        </ion-button>
      </div>
    </div>

    <div class="no-notifications" *ngIf="notifications.length === 0">
      <ion-icon name="notifications-off-outline"></ion-icon>
      <h3>No Notifications Yet</h3>
      <p>You don't have any notifications yet. New incident reports and validations will appear here.</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="notifications.length > 0">
      <ion-button 
        expand="block" 
        fill="outline"
        color="success"
        (click)="markAllAsRead()"
        class="action-btn">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Mark All Read
      </ion-button>
      <ion-button 
        expand="block" 
        fill="solid" 
        color="danger"
        (click)="clearAllNotifications()"
        class="action-btn">
        <ion-icon name="trash-outline" slot="start"></ion-icon>
        Clear All
      </ion-button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading notifications...</p>
  </div>
</ion-content>