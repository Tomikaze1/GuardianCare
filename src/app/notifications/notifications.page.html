<ion-content class="notifications-content" fullscreen>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="arrow-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="lines"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Header - Notifications Specific Design -->
  <div class="logo-container">
    <div class="logo-wrapper">
      <div class="custom-logo">
        <ion-icon name="shield" class="shield-icon"></ion-icon>
        <ion-icon name="notifications" class="notifications-icon"></ion-icon>
      </div>
      <div class="logo-glow"></div>
    </div>
    <div class="app-title">{{ 'NOTIFICATIONS.TITLE' | translate }}</div>
    <div class="app-subtitle">{{ 'NOTIFICATIONS.SUBTITLE' | translate }}</div>
    <div class="title-underline"></div>
  </div>

  <!-- Notifications List -->
  <div class="notifications-list" *ngIf="!isLoading">
    
    <!-- Filters -->
    <div class="filters-row" *ngIf="notifications.length > 0">
      <ion-chip [outline]="activeFilter !== 'all'" (click)="setFilter('all')">All</ion-chip>
      <ion-chip [outline]="activeFilter !== 'new'" (click)="setFilter('new')">New</ion-chip>
      <ion-chip [outline]="activeFilter !== 'unread'" (click)="setFilter('unread')">Unread</ion-chip>
      <ion-toggle class="sticky-toggle" [checked]="stickyNew" (ionChange)="toggleStickyNew($event)">Stick NEW on top</ion-toggle>
    </div>
    
    <!-- Empty State -->
    <div class="empty-state" *ngIf="notifications.length === 0">
      <ion-icon name="notifications-off" class="empty-icon"></ion-icon>
      <h3 class="empty-title">No New Notifications</h3>
      <p class="empty-message">
        You're all caught up! New incident reports and validations will appear here.
      </p>
    </div>

    <!-- Notification Items - Matching Reports Card Design -->
    <div class="notifications-section" *ngIf="notifications.length > 0">
      <div class="section-header">
        <span class="vertical-indicator"></span>
        <h3 class="section-title">Recent Notifications</h3>
      </div>

      <div class="notifications-grid">
        <div class="notification-card" 
             *ngFor="let notification of filteredNotifications; trackBy: trackByNotificationId"
             [class.unread]="!notification.read"
             [class.priority-critical]="notification.priority === 'critical'"
             [class.priority-high]="notification.priority === 'high'"
             [class.priority-medium]="notification.priority === 'medium'"
             [class.priority-low]="notification.priority === 'low'">
          
          <div class="notification-header">
            <div class="notification-type">
              <ion-icon 
                [name]="getNotificationIcon(notification.type)" 
                [color]="getNotificationColor(notification.type)">
              </ion-icon>
              <span>{{ notification.title }}</span>
              <ion-badge *ngIf="isNewBadge(notification)" color="success" class="new-badge">NEW</ion-badge>
            </div>
            <ion-chip 
              [color]="getPriorityColor(notification.priority)" 
              size="small"
              class="priority-chip">
              <ion-icon [name]="getPriorityIcon(notification.priority)"></ion-icon>
              <ion-label>{{ notification.priority }}</ion-label>
            </ion-chip>
          </div>

          <div class="notification-content" (click)="markAsRead(notification)">
            <div class="notification-message">
              <p>
                {{ notification.message }}
                <ng-container *ngIf="getDistanceText(notification)">
                  â€¢ {{ getDistanceText(notification) }}
                </ng-container>
              </p>
            </div>

            <div class="notification-time">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ formatTimestamp(notification.timestamp) }}</span>
            </div>

            <div class="notification-actions">
              <ion-button 
                fill="clear" 
                size="small"
                (click)="deleteNotification(notification); $event.stopPropagation()"
                class="delete-btn">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="notifications.length > 0">
      <ion-button 
        expand="block" 
        fill="outline" 
        color="primary"
        (click)="markAllAsRead()"
        class="action-btn">
        <ion-icon name="checkmark-done" slot="start"></ion-icon>
        Mark All Read
      </ion-button>
      
      <ion-button 
        expand="block" 
        fill="solid" 
        color="danger"
        (click)="clearAllNotifications()"
        class="action-btn">
        <ion-icon name="trash" slot="start"></ion-icon>
        Clear All
      </ion-button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading notifications...</p>
  </div>
</ion-content>
