
<ion-content class="settings-content">
  
  <div class="logo-container">
    <div class="logo-wrapper">
      <div class="custom-logo">
        <ion-icon name="shield" class="shield-icon"></ion-icon>
        <ion-icon name="settings" class="settings-icon"></ion-icon>
      </div>
      <div class="logo-glow"></div>
    </div>
    <div class="app-title">{{ 'SETTINGS.TITLE' | translate }}</div>
    <div class="app-subtitle">{{ 'SETTINGS.SUBTITLE' | translate }}</div>
    <div class="title-underline"></div>
  </div>

  <!-- User Profile Section -->
  <div class="profile-section" *ngIf="userProfile">
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar">
          <ion-icon name="person-circle" class="avatar-icon"></ion-icon>
        </div>
        <div class="profile-info">
          <h2 class="profile-name">{{ getUserDisplayName() }}</h2>
          <p class="profile-role">{{ userRole }}</p>
        </div>
      </div>
      
      <div class="profile-details">
        <div class="detail-item">
          <ion-icon name="mail-outline" class="detail-icon"></ion-icon>
          <span class="detail-label">Email:</span>
          <span class="detail-value">{{ getUserEmail() }}</span>
        </div>
        
        <div class="detail-item">
          <ion-icon name="call-outline" class="detail-icon"></ion-icon>
          <span class="detail-label">Phone:</span>
          <span class="detail-value">{{ getUserPhone() }}</span>
        </div>
        
        <div class="detail-item">
          <ion-icon name="person-add-outline" class="detail-icon"></ion-icon>
          <span class="detail-label">Emergency Contact:</span>
          <span class="detail-value">{{ getEmergencyContact() }}</span>
        </div>
        
        <div class="detail-item">
          <ion-icon name="document-text-outline" class="detail-icon"></ion-icon>
          <span class="detail-label">Reports Submitted:</span>
          <span class="detail-value">{{ userReports.length }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="settings-form">
    
    <div class="form-row">
      <div class="section-header" (click)="toggleSection('account')">
        <span>{{ 'SETTINGS.ACCOUNT_SECURITY' | translate }}</span>
        <ion-icon name="chevron-forward-outline" class="section-toggle-icon" [class.open]="expandAccountSecurity"></ion-icon>
        <div class="section-underline"></div>
      </div>
      
      <div class="settings-list collapsible" [class.open]="expandAccountSecurity">
        <div class="setting-item" (click)="changePassword()">
          <div class="setting-left">
            <ion-icon name="key-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.CHANGE_PASSWORD' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="updateEmail()">
          <div class="setting-left">
            <ion-icon name="mail-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.UPDATE_EMAIL' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="linkedDevices()">
          <div class="setting-left">
            <ion-icon name="watch-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.LINKED_DEVICES' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.LINKED_DEVICES_HINT' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="twoFactorAuth()">
          <div class="setting-left">
            <ion-icon name="shield-checkmark-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.TWO_FACTOR_AUTH' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="twoFactorEnabled" (ionChange)="toggleTwoFactor()"></ion-toggle>
        </div>
      </div>
    </div>

    
    <div class="form-row">
      <div class="section-header" (click)="toggleSection('location')">
        <span>{{ 'SETTINGS.LOCATION_ALERTS' | translate }}</span>
        <ion-icon name="chevron-forward-outline" class="section-toggle-icon" [class.open]="expandLocationAlerts"></ion-icon>
        <div class="section-underline"></div>
      </div>
      
      <div class="settings-list collapsible" [class.open]="expandLocationAlerts">
        <div class="setting-item">
          <div class="setting-left">
            <ion-icon name="location-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.GPS_ACCESS' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="gpsEnabled" (ionChange)="toggleGPS()"></ion-toggle>
        </div>

        <div class="setting-item">
          <div class="setting-left">
            <ion-icon name="time-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.TIME_BASED_ALERTS' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.TIME_BASED_ALERTS_HINT' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="timeBasedAlerts" (ionChange)="toggleTimeBasedAlerts()"></ion-toggle>
        </div>

        <div class="setting-item">
          <div class="setting-left">
            <ion-icon name="warning-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.DANGER_ZONE_ALERTS' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.DANGER_ZONE_ALERTS_HINT' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="dangerZoneAlerts" (ionChange)="toggleDangerZoneAlerts()"></ion-toggle>
        </div>

        <div class="setting-item" (click)="doNotDisturbSettings()">
          <div class="setting-left">
            <ion-icon name="moon-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.DO_NOT_DISTURB' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.DO_NOT_DISTURB_HINT' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="doNotDisturbEnabled" (ionChange)="toggleDoNotDisturb()"></ion-toggle>
        </div>
      </div>
    </div>

    
    <div class="form-row">
      <div class="section-header" (click)="toggleSection('notifications')">
        <span>{{ 'SETTINGS.NOTIFICATIONS' | translate }}</span>
        <ion-icon name="chevron-forward-outline" class="section-toggle-icon" [class.open]="expandNotifications"></ion-icon>
        <div class="section-underline"></div>
      </div>
      
      <div class="settings-list collapsible" [class.open]="expandNotifications">
        <div class="setting-item" (click)="smartVibrationOptionsOpen = !smartVibrationOptionsOpen">
          <div class="setting-left">
            <ion-icon name="phone-portrait-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.SMART_VIBRATION' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="smartVibration" (ionChange)="toggleSmartVibration()" (click)="$event.stopPropagation()"></ion-toggle>
        </div>
        <!-- Smart Vibration subpanel -->
        <div class="subpanel" [class.open]="smartVibrationOptionsOpen">
          <div class="sub-item">
            <span>Pattern</span>
            <ion-segment [(ngModel)]="selectedVibrationPattern">
              <ion-segment-button value="gentle"><ion-label>Gentle</ion-label></ion-segment-button>
              <ion-segment-button value="default"><ion-label>Default</ion-label></ion-segment-button>
              <ion-segment-button value="strong"><ion-label>Strong</ion-label></ion-segment-button>
            </ion-segment>
          </div>
          <div class="sub-item">
            <span>Duration</span>
            <ion-range min="50" max="500" step="10" [(ngModel)]="vibrationDuration">
              <ion-label slot="start">50ms</ion-label>
              <ion-label slot="end">500ms</ion-label>
            </ion-range>
          </div>
        </div>

        <div class="setting-item" (click)="alertSounds()">
          <div class="setting-left">
            <ion-icon name="volume-high-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.ALERT_SOUNDS' | translate }}</span>
          </div>
          <div class="setting-right">
            <span class="setting-value">{{selectedAlertSound}}</span>
            <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <div class="setting-item" (click)="languagePreference()">
          <div class="setting-left">
            <ion-icon name="globe-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.LANGUAGE_PREFERENCE' | translate }}</span>
          </div>
          <div class="setting-right">
            <span class="setting-value">{{getLanguageName(currentLanguage)}}</span>
            <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-left">
            <ion-icon name="flash-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.PANIC_MODE_VISUALS' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.PANIC_MODE_HINT' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="panicModeVisuals" (ionChange)="togglePanicModeVisuals()"></ion-toggle>
        </div>
      </div>
    </div>

    
    <div class="form-row">
      <div class="section-header" (click)="toggleSection('localization')">
        <span>{{ 'SETTINGS.LOCALIZATION' | translate }}</span>
        <ion-icon name="chevron-forward-outline" class="section-toggle-icon" [class.open]="expandLocalization"></ion-icon>
        <div class="section-underline"></div>
      </div>
      
      <div class="settings-list collapsible" [class.open]="expandLocalization">
        <div class="setting-item" (click)="appLanguage()">
          <div class="setting-left">
            <ion-icon name="language-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.APP_LANGUAGE' | translate }}</span>
          </div>
          <div class="setting-right">
            <span class="setting-value">{{getLanguageName(currentLanguage)}}</span>
            <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <div class="setting-item" (click)="units()">
          <div class="setting-left">
            <ion-icon name="scale-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.UNITS' | translate }}</span>
          </div>
          <div class="setting-right">
            <span class="setting-value">{{selectedUnit}}</span>
            <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-left">
                                    <ion-icon name="language-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.TOURIST_TRANSLATION' | translate }}</span>
          </div>
          <ion-toggle [(ngModel)]="touristTranslationMode" (ionChange)="toggleTouristTranslation()"></ion-toggle>
        </div>
        <div class="setting-item">
          <div class="setting-left">
            <ion-icon name="grid-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.HOME_UI_MODE' | translate }}</span>
            <span class="setting-subtitle">{{ 'SETTINGS.HOME_UI_MODE_HINT' | translate }}</span>
          </div>
          <ion-segment value="{{homeUIMode}}" (ionChange)="onChangeHomeUiMode($event)" class="ui-mode-segment">
            <ion-segment-button value="sidebar">
              <ion-label>{{ 'SETTINGS.HOME_UI_SIDEBAR' | translate }}</ion-label>
            </ion-segment-button>
            <ion-segment-button value="buttons">
              <ion-label>{{ 'SETTINGS.HOME_UI_BUTTONS' | translate }}</ion-label>
            </ion-segment-button>
          </ion-segment>
        </div>
      </div>
    </div>

    
    <div class="form-row">
      <div class="section-header" (click)="toggleSection('legal')">
        <span>{{ 'SETTINGS.LEGAL_SUPPORT' | translate }}</span>
        <ion-icon name="chevron-forward-outline" class="section-toggle-icon" [class.open]="expandLegalSupport"></ion-icon>
        <div class="section-underline"></div>
      </div>
      
      <div class="settings-list collapsible" [class.open]="expandLegalSupport">
        <div class="setting-item" (click)="termsOfService()">
          <div class="setting-left">
            <ion-icon name="document-text-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.TERMS_OF_SERVICE' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="privacyPolicy()">
          <div class="setting-left">
            <ion-icon name="shield-checkmark-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.PRIVACY_POLICY' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="contactSupport()">
          <div class="setting-left">
            <ion-icon name="headset-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.CONTACT_SUPPORT' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>

        <div class="setting-item" (click)="resetToDefaults()">
          <div class="setting-left">
            <ion-icon name="refresh-outline" class="setting-icon"></ion-icon>
            <span class="setting-label">{{ 'SETTINGS.RESET_DEFAULTS' | translate }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow-icon"></ion-icon>
        </div>
      </div>
    </div>

    
    <div class="form-row">
      <div class="section-header">
        <span>{{ 'SETTINGS.ABOUT_US' | translate }}</span>
        <div class="section-underline"></div>
      </div>
      
      <div class="about-card">
        <div class="about-content">
          <ion-icon name="information-circle-outline" class="about-icon"></ion-icon>
          <div class="about-text">
            <h3>GuardianCare</h3>
            <p>{{ 'SETTINGS.ABOUT_TEXT' | translate }}</p>
            <span class="version">{{ 'SETTINGS.VERSION' | translate }}</span>
          </div>
        </div>
      </div>
    </div>

    


    
    <!-- Report History Section -->
    <div class="form-row" *ngIf="userReports.length > 0">
      <div class="section-header">
        <span>Report History</span>
        <div class="section-underline"></div>
      </div>
      
      <div class="reports-container">
        <div class="report-item" *ngFor="let report of userReports">
          <div class="report-header">
            <div class="report-type">
              <ion-icon [name]="getReportTypeIcon(report.type)" class="report-type-icon"></ion-icon>
              <span class="report-type-label">{{ formatReportType(report.type) }}</span>
            </div>
            <div class="report-status">
              <span class="status-badge" [class]="getReportStatusBadgeClass(report.status)">{{ report.status }}</span>
            </div>
          </div>
          
          <div class="report-content">
            <p class="report-description">{{ report.description }}</p>
            
            <!-- Enhanced Time and Zone Information -->
            <div class="report-enhancements">
              <!-- Zone Danger Level -->
              <div class="zone-info" *ngIf="report.zoneDangerLevel">
                <div class="zone-badge" [class]="getZoneDangerBadgeClass(report.zoneDangerLevel)">
                  <ion-icon [name]="getZoneDangerIcon(report.zoneDangerLevel)" class="zone-icon"></ion-icon>
                  <span class="zone-level">{{ report.zoneDangerLevel }}</span>
                  <span class="zone-name" *ngIf="report.zoneName"> - {{ report.zoneName }}</span>
                </div>
              </div>

              <!-- Time Information -->
              <div class="time-info">
                <div class="time-detail">
                  <ion-icon [name]="getTimeOfDayIcon(report.timeOfDay)" class="time-icon"></ion-icon>
                  <span class="time-text">{{ formatEnhancedDate(report) }}</span>
                </div>
                <div class="time-context" *ngIf="report.timeOfDay && report.dayOfWeek">
                  <span class="time-of-day">{{ report.timeOfDay }}</span>
                  <span class="day-of-week"> • {{ report.dayOfWeek }}</span>
                  <span class="timezone" *ngIf="report.timezone"> • {{ report.timezone }}</span>
                </div>
              </div>
            </div>

            <!-- Location Information -->
            <div class="report-meta">
              <div class="report-location">
                <ion-icon name="location-outline" class="meta-icon"></ion-icon>
                <span class="location-text">{{ getSimplifiedLocation(report) }}</span>
              </div>
              <!-- Show full address as tooltip or expandable if different from simplified -->
              <div class="full-address" *ngIf="report.location?.fullAddress && report.location?.fullAddress !== getSimplifiedLocation(report)">
                <ion-icon name="information-circle-outline" class="info-icon"></ion-icon>
                <span class="address-tooltip">{{ report.location.fullAddress }}</span>
              </div>
            </div>
          </div>
          
          <div class="report-footer" *ngIf="report.media && report.media.length > 0">
            <div class="report-media">
              <ion-icon name="camera-outline" class="media-icon"></ion-icon>
              <span>{{ report.media.length }} photo(s)</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Reports Message -->
    <div class="form-row" *ngIf="userReports.length === 0 && userProfile">
      <div class="section-header">
        <span>Report History</span>
        <div class="section-underline"></div>
      </div>
      
      <div class="no-reports-container">
        <div class="no-reports-icon">
          <ion-icon name="document-text-outline"></ion-icon>
        </div>
        <h3 class="no-reports-title">No Reports Yet</h3>
        <p class="no-reports-message">You haven't submitted any reports yet. Start by reporting an incident to help keep your community safe.</p>
        <ion-button fill="outline" routerLink="/tabs/reports" class="submit-report-btn">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Submit Your First Report
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
