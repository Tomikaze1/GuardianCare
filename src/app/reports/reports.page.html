<ion-content class="report-content" fullscreen>
  <div class="logo-container">
    <div class="logo-wrapper">
      <div class="custom-logo">
        <ion-icon name="shield" class="shield-icon"></ion-icon>
        <ion-icon name="location" class="location-pin"></ion-icon>
      </div>
      <div class="logo-glow"></div>
    </div>
    <div class="app-title">Incident Report</div>
    <div class="app-subtitle">Help keep your community safe</div>
    <div class="title-underline"></div>
  </div>

  <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="report-form">
    <div class="section-header">
      <span>Incident Details</span>
      <div class="section-underline"></div>
    </div>

    <div class="form-row incident-types">
      <button type="button"
        class="input-box incident-type-btn"
        [class.selected]="selectedIncidentType === 'crime'"
        (click)="selectIncidentType('crime')"
        title="Crime">
        <ion-icon name="shield-outline"></ion-icon>
        Crime
      </button>
      <button type="button"
        class="input-box incident-type-btn"
        [class.selected]="selectedIncidentType === 'accident'"
        (click)="selectIncidentType('accident')"
        title="Accident">
        <ion-icon name="car-outline"></ion-icon>
        Accident
      </button>
      <button type="button"
        class="input-box incident-type-btn"
        [class.selected]="selectedIncidentType === 'emergency'"
        (click)="selectIncidentType('emergency')"
        title="Emergency">
        <ion-icon name="warning-outline"></ion-icon>
        Emergency
      </button>
      <button type="button"
        class="input-box incident-type-btn"
        [class.selected]="selectedIncidentType === 'suspicious'"
        (click)="selectIncidentType('suspicious')"
        title="Suspicious Activity">
        <ion-icon name="eye-outline"></ion-icon>
        Suspicious Activity
      </button>
    </div>

    <div class="section-header">
      <span>Descriptions</span>
      <div class="section-underline"></div>
    </div>

    <div class="form-row">
      <div class="input-box">
        <ion-icon name="document-text-outline"></ion-icon>
        <textarea
          formControlName="description"
          rows="2"
          maxlength="300"
          placeholder="Describe what happened..."></textarea>
      </div>
    </div>

    <div class="section-header">
      <span>Media Upload</span>
      <div class="section-underline"></div>
    </div>

    <div class="form-row">
      <div class="input-box media-box">
        <div class="media-buttons">
          <button type="button" (click)="takePhoto()" title="Take Photo" class="media-btn camera-btn">
            <ion-icon name="camera-outline"></ion-icon>
            <span>Take Photo</span>
          </button>
          <button type="button" (click)="selectFromGallery()" title="Select from Gallery" class="media-btn gallery-btn">
            <ion-icon name="images-outline"></ion-icon>
            <span>Gallery</span>
          </button>
        </div>
        
        <input type="file" multiple accept="image/*" (change)="onFileSelected($event)" style="display: none;" #fileInput>
        
        <div class="media-list" *ngIf="reportForm.get('media')?.value?.length > 0">
          <div class="media-chip" *ngFor="let media of reportForm.get('media')?.value; let i = index">
            <div class="media-preview" *ngIf="media.webPath || media.dataUrl">
              <img [src]="media.webPath || media.dataUrl" alt="Media preview" class="preview-image">
            </div>
            <span class="media-name">{{ media.name || 'Photo ' + (i + 1) }}</span>
            <ion-icon name="close" class="remove" (click)="removeFile(i)" title="Remove"></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <div class="section-header">
      <span>Location</span>
      <div class="section-underline"></div>
    </div>

    <div class="form-row">
      <div class="input-box location-box">
        <div class="location-header">
          <ion-icon name="location-outline" class="location-icon"></ion-icon>
          <span class="location-title">Current Location</span>
          <button type="button" class="refresh-location-btn" (click)="refreshLocation()" title="Refresh Location">
            <ion-icon name="refresh-outline"></ion-icon>
          </button>
        </div>
        
        <!-- Enhanced Coordinates Display Card -->
        <div class="coordinates-card" *ngIf="selectedLocation">
          <div class="coordinates-content">
            <div class="coordinate-row">
              <div class="coordinate-item">
                <ion-icon name="navigate-outline" class="coord-icon"></ion-icon>
                <div class="coord-info">
                  <span class="coord-label">Latitude</span>
                  <span class="coord-value">{{ selectedLocation.lat | number:'1.8-8' }}</span>
                </div>
              </div>
              <div class="coordinate-item">
                <ion-icon name="navigate-outline" class="coord-icon"></ion-icon>
                <div class="coord-info">
                  <span class="coord-label">Longitude</span>
                  <span class="coord-value">{{ selectedLocation.lng | number:'1.8-8' }}</span>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Address Display -->
            <div class="address-display" *ngIf="locationAddress">
              <ion-icon name="location-outline" class="address-icon"></ion-icon>
              <div class="address-content">
                <span class="address-label">Location Address</span>
                <span class="address-text">{{ locationAddress }}</span>
              </div>
            </div>
            
            <div class="location-actions">
              <ion-button
                fill="clear"
                size="small"
                (click)="copyCoordinates()"
                class="action-btn copy-btn">
                <ion-icon name="copy-outline" slot="start"></ion-icon>
                Copy Coordinates
              </ion-button>
              <ion-button
                fill="clear"
                size="small"
                (click)="openInMaps()"
                class="action-btn map-btn">
                <ion-icon name="map-outline" slot="start"></ion-icon>
                Open in Maps
              </ion-button>
            </div>
          </div>
        </div>
        
        <div class="location-status" *ngIf="!selectedLocation">
                          <ion-icon name="location-outline" class="status-icon"></ion-icon>
          <span class="status-text">Location not available</span>
        </div>
      </div>
    </div>

    <div class="form-row anon-row">
      <div class="input-box anon-box">
        <ion-label>Send as anonymous</ion-label>
        <ion-toggle color="primary" formControlName="anonymous"></ion-toggle>
      </div>
    </div>

    <div class="button-row">
      <ion-button expand="block" color="danger" fill="solid" class="call-btn" (click)="callEmergency()">
        <ion-icon name="call" slot="start"></ion-icon>
        Emergency Call (911)
      </ion-button>
             <button type="submit" class="submit-btn">
         <span>
           <ion-icon name="send-outline"></ion-icon>
           Submit Report
         </span>
       </button>
    </div>
  </form>
</ion-content>
